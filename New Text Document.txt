<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Jarvis AI</title>

<!-- Google Gemini JS SDK (ESM) -->
<script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

  let genAI = null;
  let model = null;

  window.initJarvis = function () {
    const api = document.getElementById("apiKey").value.trim();
    if (!api) return alert("Please enter your API key!");

    genAI = new GoogleGenerativeAI(api);
    model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

    document.getElementById("apiScreen").style.display = "none";
    document.getElementById("main").style.display = "flex";
  };

  window.sendMessage = async function () {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";

    try {
      addLoader();
      const result = await model.generateContent(text);
      removeLoader();
      const reply = result.response.text();
      addMessage(reply, "ai");
    } catch (err) {
      removeLoader();
      addMessage("⚠️ Error: " + err.message, "ai");
    }
  };

  function addMessage(msg, sender) {
    const chat = document.getElementById("chatBox");
    const bubble = document.createElement("div");
    bubble.className = sender === "user" ? "bubble user" : "bubble ai";
    bubble.innerText = msg;

    chat.appendChild(bubble);
    chat.scrollTop = chat.scrollHeight;
  }

  function addLoader() {
    const chat = document.getElementById("chatBox");
    const loader = document.createElement("div");
    loader.className = "bubble ai loader";
    loader.innerHTML = `<div class="dot"></div><div class="dot"></div><div class="dot"></div>`;
    loader.id = "typing";
    chat.appendChild(loader);
    chat.scrollTop = chat.scrollHeight;
  }

  function removeLoader() {
    const loader = document.getElementById("typing");
    if (loader) loader.remove();
  }
</script>

<style>
/* ---------- BASE THEME ---------- */
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #0e0e0e;
  color: white;
  overflow: hidden;
}

/* ---------- API KEY SCREEN ---------- */
#apiScreen {
  position: fixed;
  inset: 0;
  background: #0d0d0d;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: 15px;
}

#apiScreen input {
  width: 350px;
  padding: 12px;
  border-radius: 8px;
  border: none;
  outline: none;
  background: #1b1b1b;
  color: white;
  font-size: 16px;
}

#apiScreen button {
  padding: 12px 25px;
  font-size: 17px;
  background: #3c3c3c;
  color: white;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: 0.2s;
}

#apiScreen button:hover {
  background: #5a5a5a;
}

/* ---------- MAIN CHAT AREA ---------- */
#main {
  display: none;
  height: 100vh;
  flex-direction: column;
}

#chatBox {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
}

/* ---------- CHAT BUBBLES ---------- */
.bubble {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 14px;
  line-height: 1.5;
  animation: fadeIn 0.25s ease;
}

.user {
  background: #1f1f1f;
  align-self: flex-end;
}

.ai {
  background: #151515;
  border-left: 3px solid #4b4b4b;
  align-self: flex-start;
}

/* ---------- TYPING DOTS ---------- */
.loader {
  display: flex;
  gap: 6px;
}

.dot {
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  animation: blink 1.4s infinite both;
}

.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes blink {
  0% { opacity: 0.2; transform: translateY(0px); }
  20% { opacity: 1; transform: translateY(-3px); }
  100% { opacity: 0.2; transform: translateY(0px); }
}

@keyframes fadeIn {
  from {opacity: 0; transform: translateY(5px);}
  to {opacity: 1; transform: translateY(0);}
}

/* ---------- INPUT AREA ---------- */
#inputArea {
  display: flex;
  padding: 15px;
  background: #0f0f0f;
  border-top: 1px solid #222;
  gap: 12px;
}

#userInput {
  flex: 1;
  padding: 13px;
  border-radius: 10px;
  background: #1a1a1a;
  border: none;
  outline: none;
  color: white;
  font-size: 16px;
}

#sendBtn {
  padding: 0 25px;
  background: #2c2c2c;
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.2s;
}

#sendBtn:hover {
  background: #4a4a4a;
}
</style>
</head>

<body>

<!-- API Key Screen -->
<div id="apiScreen">
  <h2>Enter Your Gemini API Key</h2>
  <input id="apiKey" placeholder="AIzaSyDfIURQg44G2kPK3GvpVfUsh2GlyCS1TvA" />
  <button onclick="initJarvis()">Start Jarvis</button>
</div>

<!-- MAIN CHAT -->
<div id="main">
  <div id="chatBox"></div>

  <div id="inputArea">
    <input id="userInput" placeholder="Ask Jarvis..." onkeydown="if(event.key==='Enter') sendMessage()" />
    <button id="sendBtn" onclick="sendMessage()">Send</button>
  </div>
</div>

</body>
</html>